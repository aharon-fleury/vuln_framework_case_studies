---
title: "Create trait-sensitivity and trait-adaptive capacity matrices"
author: "*Compiled on `r date()` by `r Sys.info()['user']`*"
output: 
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 3
    toc_float: yes
    number_sections: true
    theme: cerulean
    highlight: haddock
    includes: 
      in_header: '~/github/src/templates/ohara_hdr.html'
  pdf_document:
    toc: true
---

``` {r setup, echo = TRUE, message = FALSE, warning = FALSE}

knitr::opts_chunk$set(fig.width = 6, fig.height = 4, fig.path = 'figs/',
                      echo = TRUE, message = FALSE, warning = FALSE)

source('https://raw.githubusercontent.com/oharac/src/master/R/common.R')

```

# Summary

Read in Excel spreadsheet of traits separated by sensitivity traits and adaptive capacity traits.  This can be used to generate a tidy-format list of trait values that can each be assigned with a sensitivity or adaptive capacity score (yes/no or continuous 0-1) to a particular stressor, based on expert opinion/lit review.

Using the results from scores across all stressors, we can generate a matrix of sensitivity traits to stressors and adaptive capacity traits to stressors.

# Data

`_raw_data/traits_by_exposure_sensitivity_AC.xlsx' sheet 1 is the original spreadsheet created by Nat to separate how each trait affects vulnerability: exposure, sensitivity, and adaptive capacity.  Sheet 2 is a cleaned-up version incorporating some changes based on discussion between Mel and Casey.


# Methods

## Generate a new format for trait scoring

Read in the cleaned up spreadsheet, convert to tidy format (long instead of wide).

```{r}
raw_file <- here('_raw_data/traits_by_exposure_sensitivity_AC.xlsx')

trait_df <- readxl::read_excel(raw_file, sheet = 2) %>%
  mutate(trait_value = str_split(trait_value, ';'),
         matrix = str_split(matrix, '; ')) %>%
  unnest(trait_value) %>%
  unnest(matrix) %>%
  mutate(trait_value = str_trim(trait_value),
         matrix = str_trim(matrix))

sens_trait_df <- trait_df %>%
  filter(matrix == 'sensitivity') %>%
  select(-matrix)
adcap_trait_df <- trait_df %>%
  filter(matrix == 'adaptive capacity') %>%
  select(-matrix)

write_csv(sens_trait_df, here('int/sens_traits.csv'))
write_csv(adcap_trait_df, here('int/adcap_traits.csv'))
```

Sensitivity traits should be scored per stressor; adaptive capacity could be scored per stressor, but perhaps can be scored against spatial and temporal characteristics of stressors, for better consistency?  

* Spatial characteristics could be something like: 
    * localized (< 1 km in extent)
    * diffuse (> 1 km in extent)
* Temporal characteristics could be something like:
    * short duration (< 1 day)
    * long duration (> 1 day)
* Extractive stressors may require different thinking about adaptive capacity than non-extractive stressors
    * extractive
    * non-extractive
    
It may also be worth considering general resilience traits (like global population and such) separately from specific resilience traits - though this starts to get more into the weeds.

